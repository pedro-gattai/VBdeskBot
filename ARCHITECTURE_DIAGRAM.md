# VB Desk Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VB Desk OTC Auction Platform                 â”‚
â”‚                   (Trustless Sealed-Bid Auctions)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚        â”‚              â”‚        â”‚              â”‚
â”‚   Seller     â”‚        â”‚  Bidder 1    â”‚        â”‚  Bidder 2    â”‚
â”‚              â”‚        â”‚              â”‚        â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚                       â”‚
       â”‚ 1. Create             â”‚ 2. Bid                â”‚ 2. Bid
       â”‚    Auction            â”‚    (Commit)           â”‚    (Commit)
       â”‚                       â”‚                       â”‚
       â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚                     Solana Blockchain                           â”‚
â”‚                     VB Desk Program                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Auction PDA                           â”‚  â”‚
â”‚  â”‚  â€¢ Seller: Alice                                         â”‚  â”‚
â”‚  â”‚  â€¢ Token: USDC                                           â”‚  â”‚
â”‚  â”‚  â€¢ Amount: 1000                                          â”‚  â”‚
â”‚  â”‚  â€¢ Min Price: 50 SOL                                     â”‚  â”‚
â”‚  â”‚  â€¢ Commit End: T+1hr                                     â”‚  â”‚
â”‚  â”‚  â€¢ Reveal End: T+2hr                                     â”‚  â”‚
â”‚  â”‚  â€¢ Status: Active â†’ Finalized â†’ Completed                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Bid PDA   â”‚  â”‚   Bid PDA   â”‚         â”‚  Escrow Token   â”‚ â”‚
â”‚  â”‚  (Bidder 1) â”‚  â”‚  (Bidder 2) â”‚         â”‚    Account      â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚         â”‚                 â”‚ â”‚
â”‚  â”‚ Commit:     â”‚  â”‚ Commit:     â”‚         â”‚  Holds: 1000    â”‚ â”‚
â”‚  â”‚  hash(...) â”‚  â”‚  hash(...) â”‚         â”‚    USDC         â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚         â”‚                 â”‚ â”‚
â”‚  â”‚ Revealed:   â”‚  â”‚ Revealed:   â”‚         â”‚  Authority:     â”‚ â”‚
â”‚  â”‚  60 SOL    â”‚  â”‚  75 SOL    â”‚         â”‚   Auction PDA   â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚         â”‚                 â”‚ â”‚
â”‚  â”‚ Deposited:  â”‚  â”‚ Deposited:  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚  60 SOL    â”‚  â”‚  75 SOL    â”‚                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Auction Flow Timeline

```
Time:  0hr          1hr              2hr              3hr
       â”‚            â”‚                â”‚                â”‚
       â”‚â—„â”€â”€ Commit â”€â–ºâ”‚â—„â”€â”€â”€ Reveal â”€â”€â”€â–ºâ”‚â—„â”€ Settlement â”€â–ºâ”‚
       â”‚   Period   â”‚     Period     â”‚                â”‚
       â”‚            â”‚                â”‚                â”‚
       â”‚            â”‚                â”‚                â”‚
       
Phase 1: CREATE AUCTION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Seller                          Blockchain
  â”‚                                 â”‚
  â”œâ”€â”€â”€ createAuction() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚    â€¢ Amount: 1000 USDC          â”‚
  â”‚    â€¢ Min Price: 50 SOL          â”‚
  â”‚    â€¢ Deadlines                  â”‚
  â”‚                                 â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
  â”‚                           â”‚  Create   â”‚
  â”‚                           â”‚  Auction  â”‚
  â”‚                           â”‚   PDA     â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
  â”‚                                 â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
  â”‚â—„â”€â”€â”€ Transfer 1000 USDC â”€â”€â”€â”¤  Create   â”‚
  â”‚      to Escrow             â”‚  Escrow   â”‚
  â”‚                           â”‚  Account  â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  

Phase 2: COMMIT PERIOD (Hidden Bids)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Bidder 1                        Blockchain                 Bidder 2
  â”‚                                 â”‚                          â”‚
  â”‚ Generate:                       â”‚            Generate:     â”‚
  â”‚ â€¢ price = 60 SOL                â”‚            â€¢ price = 75 SOL
  â”‚ â€¢ salt = random()               â”‚            â€¢ salt = random()
  â”‚ â€¢ commit = hash(60||salt)       â”‚            â€¢ commit = hash(75||salt)
  â”‚ â€¢ SAVE SALT! ğŸ”´                 â”‚            â€¢ SAVE SALT! ğŸ”´
  â”‚                                 â”‚                          â”‚
  â”œâ”€â”€â”€ placeBid(commit, 60) â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
  â”‚    + Send 60 SOL                â”‚                          â”‚
  â”‚                                 â”‚                          â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                    â”‚
  â”‚                           â”‚  Create   â”‚                    â”‚
  â”‚                           â”‚  Bid PDA  â”‚                    â”‚
  â”‚                           â”‚ (Bidder1) â”‚                    â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
  â”‚                                 â”‚                          â”‚
  â”‚                                 â”‚â—„â”€â”€â”€ placeBid(commit, 75) â”¤
  â”‚                                 â”‚     + Send 75 SOL        â”‚
  â”‚                                 â”‚                          â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                    â”‚
  â”‚                           â”‚  Create   â”‚                    â”‚
  â”‚                           â”‚  Bid PDA  â”‚                    â”‚
  â”‚                           â”‚ (Bidder2) â”‚                    â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
  
  âš ï¸  Bids are HIDDEN! No one knows the prices yet.


Phase 3: REVEAL PERIOD (Prove Commitments)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Bidder 1                        Blockchain                 Bidder 2
  â”‚                                 â”‚                          â”‚
  â”œâ”€â”€â”€ revealBid(60, salt) â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
  â”‚                                 â”‚                          â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                    â”‚
  â”‚                           â”‚  Verify:  â”‚                    â”‚
  â”‚                           â”‚  hash(60  â”‚                    â”‚
  â”‚                           â”‚  ||salt)  â”‚                    â”‚
  â”‚                           â”‚  = commit â”‚                    â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â”‚
  â”‚                                 â”‚                          â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                    â”‚
  â”‚                           â”‚  Store:   â”‚                    â”‚
  â”‚                           â”‚ revealed  â”‚                    â”‚
  â”‚                           â”‚ = 60 SOL  â”‚                    â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
  â”‚                                 â”‚                          â”‚
  â”‚                                 â”‚â—„â”€â”€â”€ revealBid(75, salt) â”€â”¤
  â”‚                                 â”‚                          â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                    â”‚
  â”‚                           â”‚  Store:   â”‚                    â”‚
  â”‚                           â”‚ revealed  â”‚                    â”‚
  â”‚                           â”‚ = 75 SOL  â”‚                    â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
  
  ğŸ“Š Now all bids are public. Highest bid = 75 SOL (Bidder 2 wins!)


Phase 4: FINALIZATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Anyone                          Blockchain
  â”‚                                 â”‚
  â”œâ”€â”€â”€ finalizeAuction() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                 â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
  â”‚                           â”‚  Status:  â”‚
  â”‚                           â”‚ Active â†’ â”‚
  â”‚                           â”‚ Finalized â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Phase 5: SETTLEMENT (Trade Execution)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Winner (Bidder 2)               Blockchain                   Seller
  â”‚                                 â”‚                          â”‚
  â”œâ”€â”€â”€ completeTrade() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
  â”‚                                 â”‚                          â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                    â”‚
  â”‚                           â”‚ Transfer  â”‚                    â”‚
  â”‚                           â”‚ 1000 USDC â”‚                    â”‚
  â”‚â—„â”€â”€â”€â”€ 1000 USDC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Escrow   â”‚                    â”‚
  â”‚                           â”‚     â†“     â”‚                    â”‚
  â”‚                           â”‚  Winner   â”‚                    â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                    â”‚
  â”‚                                 â”‚                          â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                    â”‚
  â”‚                           â”‚ Transfer  â”‚                    â”‚
  â”‚                           â”‚  75 SOL   â”‚                    â”‚
  â”‚                           â”‚ Bid PDA   â”‚â”€â”€â”€â”€ 75 SOL â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                           â”‚     â†“     â”‚                    â”‚
  â”‚                           â”‚  Seller   â”‚                    â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
  

Phase 6: WITHDRAWAL (Losers Get Refund)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Loser (Bidder 1)                Blockchain
  â”‚                                 â”‚
  â”œâ”€â”€â”€ withdrawBid() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                                 â”‚
  â”‚                           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
  â”‚                           â”‚ Transfer  â”‚
  â”‚                           â”‚  60 SOL   â”‚
  â”‚â—„â”€â”€â”€â”€ 60 SOL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Bid PDA   â”‚
  â”‚                           â”‚     â†“     â”‚
  â”‚                           â”‚  Bidder1  â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Commit-Reveal Mechanism

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  COMMIT PHASE (Privacy)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Bidder's Local Machine              On-Chain (Public)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Generate Random Salt
   salt = [32 random bytes]
   
2. Create Data Buffer                    
   data = price || salt
   data = [60,0,0,0,0,0,0,0] || [random 32 bytes]
   
3. Compute Hash
   commitment = SHA256(data)
   commitment = 0x7a3b5c... (32 bytes)
   
4. SAVE SALT SECURELY! ğŸ”´ğŸ”´ğŸ”´         
   Database / LocalStorage
   
5. Send Transaction â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º    Bid PDA Created
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ commitment:    â”‚
                                      â”‚  0x7a3b5c...   â”‚
                                      â”‚                â”‚
                                      â”‚ revealed: None â”‚
                                      â”‚                â”‚
                                      â”‚ deposit: 60    â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      
   âš ï¸ Only the HASH is public!
   Price (60) remains SECRET on bidder's machine.


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  REVEAL PHASE (Verification)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Bidder's Local Machine              On-Chain (Public)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Retrieve Saved Salt               Bid PDA State:
   salt = fetch_from_db()            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ commitment:    â”‚
2. Send Reveal Transaction           â”‚  0x7a3b5c...   â”‚
   price = 60                        â”‚                â”‚
   salt = [saved 32 bytes] â”€â”€â”€â”€â–º     â”‚ revealed: None â”‚
                                     â”‚                â”‚
                                     â”‚ deposit: 60    â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     
                                     3. Verify:
                                        computed = SHA256(60 || salt)
                                        
                                        if computed == commitment {
                                          âœ… Valid reveal
                                        } else {
                                          âŒ Reject (wrong salt/price)
                                        }
                                     
                                     4. Update State:
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ commitment:    â”‚
                                     â”‚  0x7a3b5c...   â”‚
                                     â”‚                â”‚
                                     â”‚ revealed: 60   â”‚ âœ… Now public
                                     â”‚                â”‚
                                     â”‚ deposit: 60    â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     
   âœ… Cryptographic proof that bidder
      committed to this price earlier!
```

## Account Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚                        Auction PDA                              â”‚
â”‚  PK: Derived from ["auction", seller, token_mint]              â”‚
â”‚                                                                 â”‚
â”‚  Data:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ seller: PublicKey              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚  â”‚ token_mint: PublicKey                        â”‚           â”‚  â”‚
â”‚  â”‚ amount: 1000                                 â”‚           â”‚  â”‚
â”‚  â”‚ min_price: 50_000_000                        â”‚           â”‚  â”‚
â”‚  â”‚ commit_end_time: 1738627200                  â”‚           â”‚  â”‚
â”‚  â”‚ reveal_end_time: 1738630800                  â”‚           â”‚  â”‚
â”‚  â”‚ status: Active                               â”‚           â”‚  â”‚
â”‚  â”‚ winning_bid: Option<PublicKey>               â”‚           â”‚  â”‚
â”‚  â”‚ bump: 254                                    â”‚           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚               â”‚
â”‚  Authority for:                                 â”‚               â”‚
â”‚  â€¢ Escrow Token Account                         â”‚               â”‚
â”‚  â€¢ Token transfers during settlement            â”‚               â”‚
â”‚                                                 â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Seller's Wallet     â”‚
         â”‚  (External Account)  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚                      Escrow Token Account                       â”‚
â”‚  PK: Derived from ["escrow", auction]                           â”‚
â”‚                                                                 â”‚
â”‚  SPL Token Account:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ mint: USDC_MINT                                          â”‚  â”‚
â”‚  â”‚ owner: Auction PDA  â—„â”€â”€ Authority                        â”‚  â”‚
â”‚  â”‚ amount: 1000                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ”’ Tokens locked here during auction                           â”‚
â”‚  ğŸ”“ Released to winner or returned to seller                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â”‚      â”‚                          â”‚
â”‚      Bid PDA #1          â”‚      â”‚      Bid PDA #2          â”‚
â”‚  (Bidder 1's Bid)        â”‚      â”‚  (Bidder 2's Bid)        â”‚
â”‚                          â”‚      â”‚                          â”‚
â”‚  Seeds:                  â”‚      â”‚  Seeds:                  â”‚
â”‚  ["bid", auction,        â”‚      â”‚  ["bid", auction,        â”‚
â”‚   bidder1_pubkey]        â”‚      â”‚   bidder2_pubkey]        â”‚
â”‚                          â”‚      â”‚                          â”‚
â”‚  Data:                   â”‚      â”‚  Data:                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ auction: AuctionPK â”‚  â”‚      â”‚  â”‚ auction: AuctionPK â”‚  â”‚
â”‚  â”‚ bidder: Bidder1PK  â”‚  â”‚      â”‚  â”‚ bidder: Bidder2PK  â”‚  â”‚
â”‚  â”‚ commitment:        â”‚  â”‚      â”‚  â”‚ commitment:        â”‚  â”‚
â”‚  â”‚  [32 byte hash]    â”‚  â”‚      â”‚  â”‚  [32 byte hash]    â”‚  â”‚
â”‚  â”‚ revealed_price:    â”‚  â”‚      â”‚  â”‚ revealed_price:    â”‚  â”‚
â”‚  â”‚  Some(60 SOL)      â”‚  â”‚      â”‚  â”‚  Some(75 SOL) âœ…  â”‚  â”‚
â”‚  â”‚ deposited_amount:  â”‚  â”‚      â”‚  â”‚ deposited_amount:  â”‚  â”‚
â”‚  â”‚  60 SOL            â”‚  â”‚      â”‚  â”‚  75 SOL            â”‚  â”‚
â”‚  â”‚ bump: 253          â”‚  â”‚      â”‚  â”‚ bump: 251          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚      â”‚                          â”‚
â”‚  Account Balance:        â”‚      â”‚  Account Balance:        â”‚
â”‚  60 SOL (locked)         â”‚      â”‚  75 SOL (locked)         â”‚
â”‚                          â”‚      â”‚                          â”‚
â”‚  After Settlement:       â”‚      â”‚  After Settlement:       â”‚
â”‚  â€¢ Withdraw refund âœ…    â”‚      â”‚  â€¢ Paid to seller âœ…     â”‚
â”‚                          â”‚      â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       (Loser)                           (Winner!)
```

## Security Model Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY LAYERS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Cryptographic Privacy
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Commitment   â”‚  SHA-256 hash prevents:
â”‚   Scheme     â”‚  â€¢ Front-running
â”‚              â”‚  â€¢ Bid manipulation
â”‚ hash(price   â”‚  â€¢ Price sniping
â”‚  || salt)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  âœ… Mathematically provable


Layer 2: Temporal Access Control
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      Time â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
      
      â”‚ Commit â”‚ Reveal â”‚ Settlement â”‚
      
âœ… placeBid()   only during Commit
âœ… revealBid()  only during Reveal  
âœ… finalize()   only after Reveal
âœ… complete()   only after Finalize

Clock::get()?.unix_timestamp prevents:
â€¢ Premature reveals
â€¢ Late bids
â€¢ Out-of-order operations


Layer 3: Financial Escrow
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auction   â”‚  Tokens held in PDA
â”‚    PDA     â”‚  â€¢ Not in wallet
â”‚            â”‚  â€¢ Not custodial
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚  â€¢ Program-controlled
â”‚  â”‚ 1000 â”‚  â”‚
â”‚  â”‚ USDC â”‚  â”‚  âœ… Non-custodial
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚  âœ… Trustless
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bid PDA   â”‚  SOL held as rent + deposit
â”‚            â”‚  â€¢ Separate account per bid
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚  â€¢ Cannot be stolen
â”‚  â”‚ 60   â”‚  â”‚  â€¢ Withdrawable after
â”‚  â”‚ SOL  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚  âœ… Proof of funds
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  âœ… Fair settlement


Layer 4: State Machine
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Active â”‚ â—„â”€â”€â”€ create_auction()
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
          â”‚
          â”‚ finalize_auction()
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Finalized â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ complete_trade()
         â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Completed â”‚  âœ… Trade done
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   OR
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Active â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
        â”‚ cancel_auction()
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Cancelled â”‚  âœ… Refunded
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Each instruction checks:
require!(auction.status == ExpectedState)


Layer 5: Ownership Verification
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
#[account(
    constraint = seller_token_account.owner == seller.key()
)]

#[account(
    mut,
    seeds = [b"bid", auction.key(), bidder.key()],
    bump = bid.bump,
    constraint = bid.bidder == bidder.key()
)]

âœ… Only bidder can reveal their bid
âœ… Only seller can cancel
âœ… Token accounts verified
âœ… PDAs verified via seeds


ALL 5 LAYERS MUST PASS âœ…
```

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Instruction: revealBid()                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Is auction Active?     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚
        NO                      YES
         â”‚                       â”‚
         â–¼                       â–¼
    âŒ Return               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    AuctionNotActive        â”‚ Is current_time â”‚
                            â”‚ >= commit_end?  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                       â”‚
                        NO                      YES
                         â”‚                       â”‚
                         â–¼                       â–¼
                    âŒ Return           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    CommitPeriodNotEndedâ”‚ Is current_time  â”‚
                                        â”‚ < reveal_end?    â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚                       â”‚
                                    NO                      YES
                                     â”‚                       â”‚
                                     â–¼                       â–¼
                                âŒ Return           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                RevealPeriodEnded   â”‚ Already      â”‚
                                                    â”‚ revealed?    â”‚
                                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚                    â”‚
                                            YES                  NO
                                             â”‚                    â”‚
                                             â–¼                    â–¼
                                        âŒ Return        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        AlreadyRevealed  â”‚ Verify hash â”‚
                                                         â”‚ commitment  â”‚
                                                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                                â”‚
                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                    â”‚                    â”‚
                                                 MATCH                MISMATCH
                                                    â”‚                    â”‚
                                                    â–¼                    â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        âŒ Return
                                            â”‚ Verify depositâ”‚        InvalidReveal
                                            â”‚ == price?     â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚                    â”‚
                                      YES                  NO
                                       â”‚                    â”‚
                                       â–¼                    â–¼
                                  âœ… SUCCESS           âŒ Return
                                  Store price          DepositMismatch
                                  Emit event

13 Different Error Types = Clear Failure Modes
```

---

**This architecture ensures**:
- ğŸ”’ Privacy during bidding
- ğŸ›¡ï¸ Security through cryptography
- âš¡ Fair price discovery
- ğŸ¤ Trustless execution
- ğŸ’° Non-custodial escrow

**Perfect for OTC trading where trust is minimized and fairness is guaranteed!**
